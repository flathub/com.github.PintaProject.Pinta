app-id: com.github.PintaProject.Pinta
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
command: pinta
sdk-extensions:
  - org.freedesktop.Sdk.Extension.dotnet8
finish-args:
  # X11 + XShm access
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
  # Network access
  # for access to the add-ins repo
  - --share=network
  # Filesystem access
  - --filesystem=xdg-desktop
  - --filesystem=xdg-documents
  - --filesystem=xdg-download
  - --filesystem=xdg-pictures
  - --filesystem=xdg-public-share
  - --filesystem=xdg-templates
  - --filesystem=/run/media
  # GVfs access
  - --filesystem=xdg-run/gvfs
  - --filesystem=xdg-run/gvfsd
  - --talk-name=org.gtk.vfs.*
  # OpenGL access
  - --device=dri
cleanup:
  - /lib/pkgconfig
  - /share/man
  - '*.la'
modules:
  - name: Pinta
    build-options:
      append-path: /usr/lib/sdk/dotnet8/bin
      append-ld-library-path: /usr/lib/sdk/dotnet8/lib
      env:
        PKG_CONFIG_PATH: /app/lib/pkgconfig:/app/share/pkgconfig:/usr/lib/pkgconfig:/usr/share/pkgconfig:/usr/lib/sdk/dotnet8/lib/pkgconfig
        DOTNET_CLI_TELEMETRY_OPTOUT: 'true'
        DOTNET_SKIP_FIRST_TIME_EXPERIENCE: 'true'
    sources:
      - type: git
        url: https://github.com/PintaProject/Pinta.git
        tag: '3.1'
        commit: 09a8b7186fff18aa81d03d942547427f5331a73b
        x-checker-data:
          type: git
          tag-pattern: ^([\d.]+)$
      - nuget_sources.json
      - type: shell
        commands:
          # Use locally downloaded sources instead of build-options.build-args=["--share=network"]:
          # Generate list via: https://github.com/flatpak/flatpak-builder-tools/tree/master/dotnet/flatpak-dotnet-generator.py nuget_sources.json Pinta.sln
          - sed -i "s|^PINTA_BUILD_OPTS.*|& --source $(pwd)/nuget-sources|" Makefile.am
    modules:
      - shared-modules/intltool/intltool-0.51.json
  - name: dotnet-runtime
    buildsystem: simple
    build-options:
      no-debuginfo: true
      strip: true
    build-commands:
      - /usr/lib/sdk/dotnet8/bin/install.sh
